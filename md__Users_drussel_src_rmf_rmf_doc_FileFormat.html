<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>RMF: File Format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="RMF"/>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RMF
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__Users_drussel_src_rmf_rmf_doc_FileFormat.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">File Format </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#format">Overview</a></li>
<li class="level1"><a href="#example_files">Examples</a></li>
<li class="level1"><a href="#hierarchy">The RMF Hierarchy</a></li>
<li class="level1"><a href="#attribute">Attributes</a></li>
<li class="level1"><a href="#inheritance">Inheritance of properties</a></li>
<li class="level1"><a href="#frames">Frames</a></li>
<li class="level1"><a href="#adding">Adding custom data to an RMF</a></li>
<li class="level1"><a href="#on_disk">On disk format</a></li>
<li class="level1"><a href="#benchmarks">Benchmarks</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="format"></a>
Overview</h1>
<p>The RMF file format (short for Rich Molecular Format) stores hierarchical data about a molecular structure in a file or buffer in memoery. This data can include</p>
<ul>
<li>molecular structures stored hierarchically. These structures need</li>
<li>not be atomic resolution. feature information about parts of the</li>
<li>structures, such as how well it fits a particular measurement.</li>
<li>geometric markup such as segments, surfaces, balls, colors which can</li>
<li>be used to improve visualization</li>
</ul>
<p>For example, a protein can be stored as a hierarchy where the root is the whole molecule. The root has one node per chain, each chain has one node per residue and each residue one node per atom. Each node in the hierarchy has the appropriate data stored along with it: a chain node has the chain identifier, and a residue node has the type of the residue stored and atom nodes have coordinates, atom type and elements. Bonds between atoms or coarser elements are stored explicitly as dealing with external databases to generate bonds is the source of much of the difficulty of dealing with other formats such as PDB.</p>
<p>The file might also include a node for storing the r-value for a FRET measurement between two residues (with links to the residues) as well as extra markers to highlight key parts of the molecule.</p>
<p>Multiple conformations on the hierarchy are stored as frames. Each frame has the same hierarchical structure, but some aspects of the data (eg coordinates) can have different values for each frame (or no value for a particle frame if they happen not be be applicable then).</p>
<p>A hierarchical storage format was chose since - most biological molecules have a natural hierarchical structure - it reduces redundancy (eg the residue type is only stored once, as is the residue index) - most software uses a hierarchy of some sort to represent structures at runtime, so less translation is needed - low resolution and multiresolution structures are then more natural as they are just truncations of a full, atomic hierarchy.</p>
<p>In addition to structural information, the file can also store information about - bonds - how different parts of the structure relate to different experimental data - different organization schemes on the structure - arbitrary extra data needed by other programs - associated authorship and publication information</p>
<h1><a class="anchor" id="example_files"></a>
Examples</h1>
<p>Simple example:</p>
<ul>
<li><a href="simple.pdb.txt">simple pdb</a></li>
<li><a href="simple.txt">simple hierarchy</a> for the hierarchy and data stored</li>
<li><a href="simple.rmf3.txt">simple on disk</a> for how the data is stored in an RMF3 file.</li>
</ul>
<p>Larger pdb:</p>
<ul>
<li><a href="3U7W.pdb.txt">3U7W pdb</a></li>
<li><a href="3U7W.txt">3U7W hierarchy</a> for the hierarchy and data stored</li>
<li><a href="3U7W.rmf3.txt">3U7W on disk</a> for how the data is stored in an RMF3 file.</li>
</ul>
<h1><a class="anchor" id="hierarchy"></a>
The RMF Hierarchy</h1>
<p>More technically, each node in the RMF hierarchy has</p>
<ul>
<li>a type (<a class="el" href="namespaceRMF.html#a28a01acf71943c999e685d1e13e261d0">RMF::NodeType</a>)</li>
<li>a human readable name (<a class="el" href="classRMF_1_1NodeConstHandle.html#a8be49bdea07c4807a6b55f066ca74ad7" title="Return the number of child nodes. ">RMF::NodeHandle::get_name()</a>)</li>
<li>an ID that is unique within the file (RMF::NodeHandle::get_id())</li>
<li>and associated attributes.</li>
</ul>
<p>One accesses nodes in the hierarchy using handles, <a class="el" href="classRMF_1_1NodeHandle.html" title="A handle for a particular node in the hierarchy. ">RMF::NodeHandle</a> and <a class="el" href="classRMF_1_1NodeConstHandle.html" title="A handle for a particular node in a read-only hierarchy. ">RMF::NodeConstHandle</a>. The root handle can be fetched from the <a class="el" href="classRMF_1_1FileHandle.html" title="A handle for an RMF file. ">RMF::FileHandle</a> using <a class="el" href="classRMF_1_1FileHandle.html#a616b8a7c93023344c2a876c881476f7b">RMF::FileHandle::get_root_node()</a>.</p>
<h1><a class="anchor" id="attribute"></a>
Attributes</h1>
<p>Each attribute is identified by a key (eg <a class="el" href="namespaceRMF.html#a260d67e37197e618435696abbb3a37ce">RMF::IntKey</a>) and is defined by a unique combination of</p>
<ul>
<li>a <a class="el" href="md__Users_drussel_src_rmf_rmf_doc_DecoratorsAndAttributes.html#decoratorsattributes">category</a> such as <a class="el" href="md__Users_drussel_src_rmf_rmf_doc_DecoratorsAndAttributes.html#physics">physics</a>, identified by an <a class="el" href="namespaceRMF.html#a60dddb83d1bd6434432a9fa32463ba2f">RMF::Category</a>.</li>
<li>a name string</li>
</ul>
<p>On a per RMF basis, the data associated with a given key can either have one value for each node which has that attribute, or one value per frame per node with the attribute. The methods in <a class="el" href="classRMF_1_1NodeHandle.html" title="A handle for a particular node in the hierarchy. ">RMF::NodeHandle</a> to get and set the attributes take an optional frame number.</p>
<p>The library provides decorators to group together and provide easier manipulation of standard attributes. Examples include RMF::Particle, <a class="el" href="classRMF_1_1decorator_1_1Colored.html">RMF::decorator::Colored</a>, <a class="el" href="classRMF_1_1decorator_1_1Ball.html">RMF::decorator::Ball</a> etc. See <a class="el" href="md__Users_drussel_src_rmf_rmf_doc_DecoratorsAndAttributes.html#decoratorsattributes">Decorators</a> for more information.</p>
<p>The data types that can currently be stored in an <a class="el" href="namespaceRMF.html">RMF</a> file are </p>
<table class="doxtable">
<tr>
<th align="right">Name </th><th>Description </th><th align="center">C++ type </th><th align="center">Python type  </th></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#a86262dd447c738c45e22fae2a3375d61">RMF::Float</a> </td><td>a floating point value </td><td align="center"><code>float</code> </td><td align="center"><code>float</code> </td></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#a13cd501233c2edc77db6ebec83583eec">RMF::String</a> </td><td>a utf8 string </td><td align="center"><code>std::string</code> </td><td align="center"><code>string</code> </td></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#a42aed102a7e7e9b5ddc9feecc05fd158">RMF::Int</a> </td><td>an 64 bit integer </td><td align="center"><code>int</code> </td><td align="center"><code>int</code> </td></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#a4f81aba337d34ce6c26d7e5004fcfddf">RMF::Vector3</a> </td><td>three Float values </td><td align="center"><a class="el" href="namespaceRMF.html#a4f81aba337d34ce6c26d7e5004fcfddf">RMF::Vector3</a> </td><td align="center"><a class="el" href="namespaceRMF.html#a4f81aba337d34ce6c26d7e5004fcfddf">RMF.Vector3</a> </td></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#a1e72f2580095bf30a33fc20fa66e7bcd">RMF::Vector4</a> </td><td>four Float values </td><td align="center"><a class="el" href="namespaceRMF.html#a1e72f2580095bf30a33fc20fa66e7bcd">RMF::Vector4</a> </td><td align="center"><a class="el" href="namespaceRMF.html#a1e72f2580095bf30a33fc20fa66e7bcd">RMF.Vector4</a> </td></tr>
</table>
<p>In addition, an arbitrary length list of any of the above can be stored. The type for that is the type for the single data with an <code>s</code> on the end, eg <code>Floats</code> for a list of <code>Float</code> values. These are passed as <code>std::vector</code> like lists in <code>C++</code> and <code>lists</code> in <code>Python</code>.</p>
<p>Each data type has associated typedefs such as </p>
<table class="doxtable">
<tr>
<th align="right">Name </th><th align="center">Type </th><th>Role  </th></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#a86262dd447c738c45e22fae2a3375d61">RMF::Float</a> </td><td align="center"><code>float</code> </td><td>the type used to pass a floating point value </td></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#affffd1547fb5b085b9b5875cafe5771a">RMF::Floats</a> </td><td align="center">std::vector&lt;RMF::Float&gt; </td><td>the type used to pass a list of floating point values. It looks like an <code>std::vector</code> in <code>C++</code> and a <code>list</code> in <code>Python</code> </td></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#a403d28d7d395a6ec19a004a61cb592f7">RMF::FloatKey</a> </td><td align="center">RMF::ID&lt;RMF::FloatTraits&gt; </td><td>a RMF::Key used to identify a floating point value associated with a node in the <a class="el" href="namespaceRMF.html">RMF</a> hierarchy </td></tr>
<tr>
<td align="right"><a class="el" href="namespaceRMF.html#a72cf70a79da88403bd9bb0a48982ebce">RMF::FloatsKey</a> </td><td align="center">std::vector&lt;RMF::FloatKey&gt; </td><td>a RMF::Key used to identify a list of floating points value associated with a node in the <a class="el" href="namespaceRMF.html">RMF</a> hierarchy </td></tr>
<tr>
<td align="right">RMF::FloatTraits </td><td align="center">RMF::FloatTraits </td><td>a traits classes to tell HDF5 how to read and write one or more floating point values </td></tr>
<tr>
<td align="right">RMF::FloatsTraits </td><td align="center">RMF::FloatsTraits </td><td>a traits classes to tell HDF5 how to read and write one or more lists of floating point values </td></tr>
</table>
<h1><a class="anchor" id="inheritance"></a>
Inheritance of properties</h1>
<p>Certain nodes modify how their children should behave. This modification can be either through inheritance (eg all descendants are assumed to have the property unless they explicitly override it) or composition (the descendant's property is the ancestors composed with theirs). Note that since a given node can be reached through multiple path in the hierarchy, a given view of the file might have to have multiple objects (eg graphics) for a single node.</p>
<p>Current examples are - RMF::Colored is inherited. That is, a node that is not an RMF::Colored node, has the color of its closest RMF::Colored ancestor. - The RMF::Particle and RMF::RigidParticle coordinates are transforms of any RMF::ReferenceFrame(s) that occur on the particle itself or its ancestors. That is, a node that is a RMF::Particle or RMF::Ball with an ancestor that is an RMF::ReferenceFrame has global coordinates at the RMF::ReferenceFrame's transformation applied to its coordinates. See the example rigid_bodies.py.</p>
<h1><a class="anchor" id="frames"></a>
Frames</h1>
<p>Each <a class="el" href="namespaceRMF.html">RMF</a> file stores one or more frames (conformations). The attributes of a node in a given conformation are the union of conformation-specific attributes as well as static attributes (values that hold for all frames).</p>
<p>As with nodes, frames have a hierarchical relationship to one another. This hierarchy supports natural representation of clustering results (eg you have a frame for the cluster center with a child frame for each conformation that is in the cluster). By convention, sequential frames in a simulation should be stored as with the successor frame as a child of the predecessor.</p>
<p>Frames also have arbitrary attributes associated with them, like nodes.</p>
<h1><a class="anchor" id="adding"></a>
Adding custom data to an RMF</h1>
<p>When adding data to an RMF file that is just to be used for internal consumption, one should create a new category. For example, <a href="http://www.integrativemodeling.org">IMP</a> defines an ''imp'' category when arbitrary particle data is stored.</p>
<p>If, instead, the data is likely to be a general interest, it probably makes sense to add it to the documentation of this library so that the names used can be standardized.</p>
<h1><a class="anchor" id="on_disk"></a>
On disk format</h1>
<p>The <a class="el" href="namespaceRMF.html">RMF</a> library has supported various on-disk formats. Currently 3 output methods are support, files with suffix <code>.rmf</code> and <code>.rmfz</code> and buffers in memory.</p>
<p>The current format stores the structure in an <a href="http://avro.apache.org/docs/1.7.5/spec.html#Object+Container+Files">Avro Object Container</a>. If the <code>.rmfz</code> suffix is used, the contents are compressed. The structure is stored as a series of records, each containing either a frame or static data (there can be multiple static data frames, they are implicitly merged). Upon opening, the file is scanned once, after that, frames can be accessed in a random access fashion. See <a href="Frame.json">Frame.json</a> for the schema.</p>
<p>The format is robust to corruption (all on disk data is safe if garbage data is written or the process is killed).</p>
<p>There are several ways that the files can be made more compact (without breaking forwards compatibility of existing files). They can be investigated further if there is sufficient demand.</p>
<h1><a class="anchor" id="benchmarks"></a>
Benchmarks</h1>
<p>A quick comparison of the various options (taken from <a class="el" href="benchmark__rmf_8cpp_source.html">benchmark/benchmark_rmf.cpp</a>).</p>
<table class="doxtable">
<tr>
<th align="right">type </th><th align="right">create </th><th align="right">write frame </th><th align="right">open </th><th align="right">traverse </th><th align="right">read frame </th><th>size  </th></tr>
<tr>
<td align="right">rmf </td><td align="right">0.11 </td><td align="right">0.05 </td><td align="right">0.2 </td><td align="right">0.03 </td><td align="right">0.04 </td><td>14M </td></tr>
<tr>
<td align="right">rmfz </td><td align="right">0.09 </td><td align="right">0.10 </td><td align="right">0.5 </td><td align="right">0.03 </td><td align="right">0.05 </td><td>10M </td></tr>
<tr>
<td align="right">buffer</td><td align="right">0.09 </td><td align="right">0.10 </td><td align="right">0.5 </td><td align="right">0.03 </td><td align="right">0.05 </td><td>10M </td></tr>
</table>
<p>The operations are:</p>
<ul>
<li><code>create</code>: create a <a class="el" href="namespaceRMF.html">RMF</a> file with a hierarchy with 45000 particles</li>
<li><code>write frame</code>: save coordinates for those particles</li>
<li><code>open</code>: open the file</li>
<li><code>traverse</code>: traverse the loaded hierarchy, touching atom, residue and chain data</li>
<li><code>read frame</code>: load the coordinates from a frame</li>
<li><code>size</code>: the size of the file. The raw data saved is 11M.</li>
</ul>
<p>Note that the file stayed in RAM for these operations (hence the identical buffer and to disk times). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38924681-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
