<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>RMF: benchmark/benchmark_rmf.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="RMF"/>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RMF
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('benchmark_2benchmark_rmf_8cpp-example.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">benchmark/benchmark_rmf.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Benchmark typical creation, traversal and loading with different <a class="el" href="namespaceRMF.html">RMF</a> backends.Copyright 2007-2013 IMP Inventors. All rights reserved.</p>
<div class="fragment"><div class="line"><span class="comment">/** \example benchmark/benchmark_rmf.cpp</span></div>
<div class="line"><span class="comment"> * \brief Benchmark typical creation, traversal and loading with different RMF</span></div>
<div class="line"><span class="comment"> *        backends.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright 2007-2013 IMP Inventors. All rights reserved.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;boost/iterator/iterator_facade.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/filesystem/operations.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/timer.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;exception&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="BufferHandle_8h.html">RMF/BufferHandle.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="FileConstHandle_8h.html">RMF/FileConstHandle.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="FileHandle_8h.html">RMF/FileHandle.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ID_8h.html">RMF/ID.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="NodeConstHandle_8h.html">RMF/NodeConstHandle.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="NodeHandle_8h.html">RMF/NodeHandle.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="Vector_8h.html">RMF/Vector.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="physics_8h.html">RMF/decorator/physics.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sequence_8h.html">RMF/decorator/sequence.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ConstFile_8h.html">RMF/HDF5/ConstFile.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="enums_8h.html">RMF/enums.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="infrastructure__macros_8h.html">RMF/infrastructure_macros.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">RMF/log.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">int</span> scale = 1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">int</span> scale = 5;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">std::string show_size(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sz) {</div>
<div class="line">  std::ostringstream oss;</div>
<div class="line">  <span class="keywordflow">if</span> (sz &gt; 1000000) {</div>
<div class="line">    oss &lt;&lt; sz / 1000000 &lt;&lt; <span class="stringliteral">&quot;M&quot;</span>;</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sz &gt; 1000) {</div>
<div class="line">    oss &lt;&lt; sz / 1000 &lt;&lt; <span class="stringliteral">&quot;k&quot;</span>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    oss &lt;&lt; sz &lt;&lt; <span class="stringliteral">&quot;b&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> oss.str();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> benchmark_size(std::string path, std::string type) {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = 0;</div>
<div class="line">  <span class="keywordflow">if</span> (boost::filesystem::is_directory(path)) {</div>
<div class="line">    <span class="keywordflow">for</span> (boost::filesystem::directory_iterator it(path);</div>
<div class="line">         it != boost::filesystem::directory_iterator(); it++) {</div>
<div class="line">      size += boost::filesystem::file_size(*it);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    size = boost::filesystem::file_size(path);</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot;, size, &quot;</span> &lt;&lt; show_size(size) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; size</div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">std::size_t create_residue(<a name="_a0"></a><a class="code" href="classRMF_1_1NodeHandle.html">RMF::NodeHandle</a> nh, <a name="_a1"></a><a class="code" href="classRMF_1_1decorator_1_1AtomFactory.html">RMF::decorator::AtomFactory</a> af,</div>
<div class="line">                           <a name="_a2"></a><a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html">RMF::decorator::ParticleFactory</a> pf) {</div>
<div class="line">  std::size_t total_size = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2 * scale; ++i) {</div>
<div class="line">    <a class="code" href="classRMF_1_1NodeHandle.html">RMF::NodeHandle</a> child = nh.<a name="a3"></a><a class="code" href="classRMF_1_1NodeHandle.html#af06c3055d6c2b1d9cdc22aa101c1a049">add_child</a>(<span class="stringliteral">&quot;CA&quot;</span>, <a name="a4"></a><a class="code" href="namespaceRMF.html#ae825b3e314808ddf3813c8035f74d524">RMF::REPRESENTATION</a>);</div>
<div class="line">    pf.<a name="a5"></a><a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html#aa2e7e68d8358b111e0151b108f1d1bc1">get</a>(child).set_static_mass(1);</div>
<div class="line">    pf.<a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html#aa2e7e68d8358b111e0151b108f1d1bc1">get</a>(child).set_static_radius(1.0 + i / 18.77);</div>
<div class="line">    af.<a name="a6"></a><a class="code" href="classRMF_1_1decorator_1_1AtomFactory.html#a2398c360361e711aaf09b74f1a732c37">get</a>(child).set_static_element(7);</div>
<div class="line">    total_size += <span class="keyword">sizeof</span>(int) * 1 + <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 2;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> total_size;</div>
<div class="line">}</div>
<div class="line">std::size_t create_chain(<a class="code" href="classRMF_1_1NodeHandle.html">RMF::NodeHandle</a> nh, <a name="_a7"></a><a class="code" href="classRMF_1_1decorator_1_1ResidueFactory.html">RMF::decorator::ResidueFactory</a> rf,</div>
<div class="line">                         <a class="code" href="classRMF_1_1decorator_1_1AtomFactory.html">RMF::decorator::AtomFactory</a> af,</div>
<div class="line">                         <a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html">RMF::decorator::ParticleFactory</a> pf) {</div>
<div class="line">  std::size_t total_size = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 60 * scale; ++i) {</div>
<div class="line">    std::ostringstream oss;</div>
<div class="line">    oss &lt;&lt; i;</div>
<div class="line">    <a class="code" href="classRMF_1_1NodeHandle.html">RMF::NodeHandle</a> child = nh.<a class="code" href="classRMF_1_1NodeHandle.html#af06c3055d6c2b1d9cdc22aa101c1a049">add_child</a>(oss.str(), <a class="code" href="namespaceRMF.html#ae825b3e314808ddf3813c8035f74d524">RMF::REPRESENTATION</a>);</div>
<div class="line">    rf.<a name="a8"></a><a class="code" href="classRMF_1_1decorator_1_1ResidueFactory.html#ab7d18a3669ba04651f0800efe237ac88">get</a>(child).set_static_residue_type(<span class="stringliteral">&quot;cys&quot;</span>);</div>
<div class="line">    rf.<a class="code" href="classRMF_1_1decorator_1_1ResidueFactory.html#ab7d18a3669ba04651f0800efe237ac88">get</a>(child).set_static_residue_index(i);</div>
<div class="line">    total_size += <span class="keyword">sizeof</span>(int) + 4;</div>
<div class="line">    total_size += create_residue(child, af, pf);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> total_size;</div>
<div class="line">}</div>
<div class="line">std::size_t create_hierarchy(<a name="_a9"></a><a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> file) {</div>
<div class="line">  <a name="_a10"></a><a class="code" href="classRMF_1_1decorator_1_1ChainFactory.html">RMF::decorator::ChainFactory</a> cf(file);</div>
<div class="line">  <a class="code" href="classRMF_1_1decorator_1_1AtomFactory.html">RMF::decorator::AtomFactory</a> af(file);</div>
<div class="line">  <a class="code" href="classRMF_1_1decorator_1_1ResidueFactory.html">RMF::decorator::ResidueFactory</a> rf(file);</div>
<div class="line">  <a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html">RMF::decorator::ParticleFactory</a> pf(file);</div>
<div class="line">  <a class="code" href="classRMF_1_1NodeHandle.html">RMF::NodeHandle</a> n = file.<a name="a11"></a><a class="code" href="classRMF_1_1FileHandle.html#a616b8a7c93023344c2a876c881476f7b">get_root_node</a>();</div>
<div class="line">  std::size_t total_size = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 3 * scale; ++i) {</div>
<div class="line">    std::ostringstream oss;</div>
<div class="line">    oss &lt;&lt; i;</div>
<div class="line">    <a class="code" href="classRMF_1_1NodeHandle.html">RMF::NodeHandle</a> child = n.<a class="code" href="classRMF_1_1NodeHandle.html#af06c3055d6c2b1d9cdc22aa101c1a049">add_child</a>(oss.str(), <a class="code" href="namespaceRMF.html#ae825b3e314808ddf3813c8035f74d524">RMF::REPRESENTATION</a>);</div>
<div class="line">    cf.<a name="a12"></a><a class="code" href="classRMF_1_1decorator_1_1ChainFactory.html#a830bcbee721d2deef3af7d2b76055d58">get</a>(child).set_static_chain_id(oss.str());</div>
<div class="line">    total_size += oss.str().size();</div>
<div class="line">    total_size += create_chain(child, rf, af, pf);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> total_size;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">std::pair&lt;double, std::size_t&gt; create_frame(<a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> fh,</div>
<div class="line">                                            <a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html">RMF::decorator::ParticleFactory</a> ipf,</div>
<div class="line">                                            <span class="keyword">const</span> <a class="code" href="namespaceRMF.html#aa8add0668393fee2450b059fa221f709">RMF::NodeIDs</a>&amp; atoms,</div>
<div class="line">                                            <span class="keywordtype">int</span> frame) {</div>
<div class="line">  <a name="_a13"></a><a class="code" href="classRMF_1_1Vector.html">RMF::Vector3</a> ret(0, 0, 0);</div>
<div class="line">  std::size_t total_size = 0;</div>
<div class="line">  RMF_FOREACH(<a name="_a14"></a><a class="code" href="classRMF_1_1ID.html">RMF::NodeID</a> n, atoms) {</div>
<div class="line">    <a class="code" href="classRMF_1_1Vector.html">RMF::Vector3</a> v((n.<a name="a15"></a>get_index() + 0 + frame) / 17.0,</div>
<div class="line">                   (n.get_index() + 1 + frame) / 19.0,</div>
<div class="line">                   (n.get_index() + 2 + frame) / 23.0);</div>
<div class="line">    ret[0] += v[0];</div>
<div class="line">    ret[1] += v[1];</div>
<div class="line">    ret[2] += v[2];</div>
<div class="line">    ipf.<a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html#aa2e7e68d8358b111e0151b108f1d1bc1">get</a>(fh.<a name="a16"></a><a class="code" href="classRMF_1_1FileHandle.html#ae6a14319cd485318420685f86fcfb942">get_node</a>(n)).set_frame_coordinates(v);</div>
<div class="line">    total_size += <span class="keyword">sizeof</span>(float) * 3;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> std::make_pair(ret[0] + ret[1] + ret[2], total_size);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">boost::tuple&lt;double, std::size_t, std::size_t&gt; create(<a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> file) {</div>
<div class="line">  std::size_t hierarchy_size = create_hierarchy(file);</div>
<div class="line">  <a class="code" href="namespaceRMF.html#aa8add0668393fee2450b059fa221f709">RMF::NodeIDs</a> atoms;</div>
<div class="line">  RMF_FOREACH(<a class="code" href="classRMF_1_1ID.html">RMF::NodeID</a> n, file.<a name="a17"></a>get_node_ids()) {</div>
<div class="line">    <span class="keywordflow">if</span> (file.<a class="code" href="classRMF_1_1FileHandle.html#ae6a14319cd485318420685f86fcfb942">get_node</a>(n).<a name="a18"></a>get_children().empty()) {</div>
<div class="line">      atoms.push_back(n);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html">RMF::decorator::ParticleFactory</a> ipf(file);</div>
<div class="line">  <span class="keywordtype">double</span> check_value = 0;</div>
<div class="line">  std::size_t frame_size = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 20; ++i) {</div>
<div class="line">    file.<a name="a19"></a><a class="code" href="classRMF_1_1FileHandle.html#a1ceef1ac9c930427a1659cade36d3c8a">add_frame</a>(<span class="stringliteral">&quot;frame&quot;</span>, <a name="a20"></a><a class="code" href="namespaceRMF.html#a422bc753b1f82ca61342597f2c923858">RMF::FRAME</a>);</div>
<div class="line">    std::pair&lt;double, std::size_t&gt; cur = create_frame(file, ipf, atoms, i);</div>
<div class="line">    check_value += cur.first;</div>
<div class="line">    frame_size += cur.second;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> boost::make_tuple(check_value, hierarchy_size, frame_size);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> traverse(<a name="_a21"></a><a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> file) {</div>
<div class="line">  <span class="keywordtype">double</span> ret = 0;</div>
<div class="line">  <a class="code" href="namespaceRMF.html#a86f52fc57f697e90997a72fcdbe20072">RMF::NodeConstHandles</a> queue(1, file.<a name="a22"></a><a class="code" href="classRMF_1_1FileConstHandle.html#a9c464cf39ee7e81f6c37af5419f26828">get_root_node</a>());</div>
<div class="line">  <a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html">RMF::decorator::ParticleFactory</a> ipcf(file);</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    <a name="_a23"></a><a class="code" href="classRMF_1_1NodeConstHandle.html">RMF::NodeConstHandle</a> cur = queue.back();</div>
<div class="line">    queue.pop_back();</div>
<div class="line">    <span class="keywordflow">if</span> (ipcf.get_is(cur)) {</div>
<div class="line">      ret += ipcf.get(cur).get_radius();</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="namespaceRMF.html#a86f52fc57f697e90997a72fcdbe20072">RMF::NodeConstHandles</a> children = cur.<a name="a24"></a>get_children();</div>
<div class="line">    queue.insert(queue.end(), children.begin(), children.end());</div>
<div class="line">  } <span class="keywordflow">while</span> (!queue.empty());</div>
<div class="line">  <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> load(<a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> file, <span class="keyword">const</span> <a class="code" href="namespaceRMF.html#aa8add0668393fee2450b059fa221f709">RMF::NodeIDs</a>&amp; nodes) {</div>
<div class="line">  <a name="_a25"></a><a class="code" href="classRMF_1_1decorator_1_1IntermediateParticleFactory.html">RMF::decorator::IntermediateParticleFactory</a> ipcf(file);</div>
<div class="line">  <a class="code" href="classRMF_1_1Vector.html">RMF::Vector3</a> v(0, 0, 0);</div>
<div class="line">  RMF_FOREACH(<a name="_a26"></a><a class="code" href="classRMF_1_1ID.html">RMF::FrameID</a> fr, file.<a name="a27"></a>get_frames()) {</div>
<div class="line">    file.<a name="a28"></a>set_current_frame(fr);</div>
<div class="line">    RMF_FOREACH(<a class="code" href="classRMF_1_1ID.html">RMF::NodeID</a> n, nodes) {</div>
<div class="line">      <a class="code" href="classRMF_1_1Vector.html">RMF::Vector3</a> cur = ipcf.<a name="a29"></a><a class="code" href="classRMF_1_1decorator_1_1IntermediateParticleFactory.html#a1a74810ca15fc49929dbcaecfbd9668c">get</a>(file.<a name="a30"></a>get_node(n)).get_coordinates();</div>
<div class="line">      v[0] += cur[0];</div>
<div class="line">      v[1] += cur[1];</div>
<div class="line">      v[2] += cur[2];</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> v[0] + v[1] + v[2];</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">std::pair&lt;std::size_t, std::size_t&gt; benchmark_create(<a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> file,</div>
<div class="line">                                                     std::string type) {</div>
<div class="line">  boost::timer timer;</div>
<div class="line">  boost::tuple&lt;double, std::size_t, std::size_t&gt; cur = create(file);</div>
<div class="line">  std::cout &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot;, create, &quot;</span> &lt;&lt; timer.elapsed() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; cur.get&lt;0&gt;()</div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">return</span> std::make_pair(cur.get&lt;1&gt;(), cur.get&lt;2&gt;());</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> benchmark_traverse(<a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> file, std::string type) {</div>
<div class="line">  file.set_current_frame(<a class="code" href="classRMF_1_1ID.html">RMF::FrameID</a>(0));</div>
<div class="line">  boost::timer timer;</div>
<div class="line">  <span class="keywordtype">double</span> count = 0;</div>
<div class="line">  <span class="keywordtype">double</span> t;</div>
<div class="line">  <span class="keywordflow">while</span> (timer.elapsed() &lt; 1) {</div>
<div class="line">    t = traverse(file);</div>
<div class="line">    ++count;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot;, traverse, &quot;</span> &lt;&lt; timer.elapsed() / count &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; t</div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> benchmark_load(<a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> file, std::string type) {</div>
<div class="line">  <a class="code" href="namespaceRMF.html#aa8add0668393fee2450b059fa221f709">RMF::NodeIDs</a> nodes;</div>
<div class="line">  <a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html">RMF::decorator::ParticleFactory</a> ipcf(file);</div>
<div class="line">  RMF_FOREACH(<a class="code" href="classRMF_1_1ID.html">RMF::NodeID</a> n, file.get_node_ids()) {</div>
<div class="line">    <span class="keywordflow">if</span> (ipcf.<a name="a31"></a><a class="code" href="classRMF_1_1decorator_1_1ParticleFactory.html#a9aded9b70e64339b1fe863fcf0409ab0">get_is</a>(file.get_node(n))) nodes.push_back(n);</div>
<div class="line">  }</div>
<div class="line">  boost::timer timer;</div>
<div class="line">  <span class="keywordtype">double</span> dist = load(file, nodes);</div>
<div class="line">  std::cout &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot;, load, &quot;</span> &lt;&lt; timer.elapsed() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dist</div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> benchmark_open(std::string path, std::string type) {</div>
<div class="line">  boost::timer timer;</div>
<div class="line">  <a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> ret;</div>
<div class="line">  <span class="keywordtype">double</span> count = 0;</div>
<div class="line">  <span class="keywordflow">while</span> (timer.elapsed() &lt; 1) {</div>
<div class="line">    ret = <a name="a32"></a><a class="code" href="namespaceRMF.html#ac90654bbc3bc8b1d67aabcb206b08306">RMF::open_rmf_file_read_only</a>(path);</div>
<div class="line">    ++count;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot;, open, &quot;</span> &lt;&lt; timer.elapsed() / count &lt;&lt; <span class="stringliteral">&quot;, 0&quot;</span></div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line">}  <span class="comment">// namespace</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span>, <span class="keywordtype">char</span>**) {</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <a name="a33"></a><a class="code" href="namespaceRMF.html#ac600cc982dce090a5001e53352b20a68">RMF::set_log_level</a>(<span class="stringliteral">&quot;Off&quot;</span>);</div>
<div class="line">    std::string name_base = RMF::internal::get_unique_path();</div>
<div class="line"><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    std::cout &lt;&lt; name_base &lt;&lt; std::endl;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    {</div>
<div class="line">      <span class="keyword">const</span> std::string name = name_base + <span class="stringliteral">&quot;.rmf3&quot;</span>;</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> fh = <a name="a34"></a><a class="code" href="namespaceRMF.html#ab8681fee96c0b5e2cb33cd723e99b1b0">RMF::create_rmf_file</a>(name);</div>
<div class="line">        std::pair&lt;std::size_t, std::size_t&gt; sizes =</div>
<div class="line">            benchmark_create(fh, <span class="stringliteral">&quot;rmf3&quot;</span>);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;raw, total, &quot;</span> &lt;&lt; show_size(sizes.first + sizes.second)</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; (sizes.first + sizes.second) &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;raw, frame, &quot;</span> &lt;&lt; show_size(sizes.second) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">                  &lt;&lt; sizes.second &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> fh = benchmark_open(name, <span class="stringliteral">&quot;rmf3&quot;</span>);</div>
<div class="line">        benchmark_traverse(fh, <span class="stringliteral">&quot;rmf3&quot;</span>);</div>
<div class="line">        benchmark_load(fh, <span class="stringliteral">&quot;rmf3&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      benchmark_size(name, <span class="stringliteral">&quot;rmf3&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> std::string name = name_base + <span class="stringliteral">&quot;.rmfz&quot;</span>;</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> fh = <a class="code" href="namespaceRMF.html#ab8681fee96c0b5e2cb33cd723e99b1b0">RMF::create_rmf_file</a>(name);</div>
<div class="line">        benchmark_create(fh, <span class="stringliteral">&quot;rmfz&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> fh = benchmark_open(name, <span class="stringliteral">&quot;rmfz&quot;</span>);</div>
<div class="line">        benchmark_traverse(fh, <span class="stringliteral">&quot;rmfz&quot;</span>);</div>
<div class="line">        benchmark_load(fh, <span class="stringliteral">&quot;rmfz&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      benchmark_size(name, <span class="stringliteral">&quot;rmfz&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> std::string name = name_base + <span class="stringliteral">&quot;.rmf&quot;</span>;</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> fh = <a class="code" href="namespaceRMF.html#ab8681fee96c0b5e2cb33cd723e99b1b0">RMF::create_rmf_file</a>(name);</div>
<div class="line">        benchmark_create(fh, <span class="stringliteral">&quot;rmf&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> fh = benchmark_open(name, <span class="stringliteral">&quot;rmf&quot;</span>);</div>
<div class="line">        benchmark_traverse(fh, <span class="stringliteral">&quot;rmf&quot;</span>);</div>
<div class="line">        benchmark_load(fh, <span class="stringliteral">&quot;rmf&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      benchmark_size(name, <span class="stringliteral">&quot;rmf&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      <a name="_a35"></a><a class="code" href="classRMF_1_1BufferHandle.html">RMF::BufferHandle</a> buffer;</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> fh = <a name="a36"></a><a class="code" href="namespaceRMF.html#acb67d60e21f39a8d3b3d877192e02fae">RMF::create_rmf_buffer</a>(buffer);</div>
<div class="line">        benchmark_create(fh, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> fh = <a name="a37"></a><a class="code" href="namespaceRMF.html#a25b9eb4fac988c9195b16f25755b5ec9">RMF::open_rmf_buffer_read_only</a>(buffer);</div>
<div class="line">        benchmark_traverse(fh, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line">        benchmark_load(fh, <span class="stringliteral">&quot;buffer&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> std::string name = name_base + <span class="stringliteral">&quot;.rmf2&quot;</span>;</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> fh = <a class="code" href="namespaceRMF.html#ab8681fee96c0b5e2cb33cd723e99b1b0">RMF::create_rmf_file</a>(name);</div>
<div class="line">        benchmark_create(fh, <span class="stringliteral">&quot;rmf2&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> fh = <a class="code" href="namespaceRMF.html#ac90654bbc3bc8b1d67aabcb206b08306">RMF::open_rmf_file_read_only</a>(name);</div>
<div class="line">        benchmark_traverse(fh, <span class="stringliteral">&quot;rmf2&quot;</span>);</div>
<div class="line">        benchmark_load(fh, <span class="stringliteral">&quot;rmf2&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      benchmark_size(name, <span class="stringliteral">&quot;rmf2&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> std::string name = name_base + <span class="stringliteral">&quot;.rmfa&quot;</span>;</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileHandle.html">RMF::FileHandle</a> fh = <a class="code" href="namespaceRMF.html#ab8681fee96c0b5e2cb33cd723e99b1b0">RMF::create_rmf_file</a>(name);</div>
<div class="line">        benchmark_create(fh, <span class="stringliteral">&quot;rmfa&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classRMF_1_1FileConstHandle.html">RMF::FileConstHandle</a> fh = <a class="code" href="namespaceRMF.html#ac90654bbc3bc8b1d67aabcb206b08306">RMF::open_rmf_file_read_only</a>(name);</div>
<div class="line">        benchmark_traverse(fh, <span class="stringliteral">&quot;rmfa&quot;</span>);</div>
<div class="line">        benchmark_load(fh, <span class="stringliteral">&quot;rmfa&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      benchmark_size(name, <span class="stringliteral">&quot;rmfa&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception thrown: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38924681-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
